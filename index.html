<!DOCTYPE html>
<html>
	<head>

		<meta charset="utf-8" />
		<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
		<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.0.js"></script>
		<title>ArcGIS API for JavaScript Tutorials: Display a map</title>

		<style>
			html,
			body,
			#viewDiv1 {
				padding: 0;
				margin: 0;
				height: 100%;
				width: 50%;
				left: 0;
				position: fixed;
			}
			#viewDiv2 {
				padding: 0;
				margin: 0;
				height: 100%;
				width: 50%;
				right: 0;
				position: fixed;
			}
			#viewDiv3 {
				padding: 0;
				margin: 0;
				height: 100%;
				width: 50%;
				right: 0;
				position: fixed;
			}
		</style>

		<link rel="stylesheet" href="https://js.arcgis.com/4.19/esri/themes/light/main.css">
		<script src="https://js.arcgis.com/4.19/"></script>

		<script>
			require(["esri/config",
					"esri/Map",
					"esri/views/MapView",
					"esri/layers/FeatureLayer",
					"esri/widgets/LayerList",
					"esri/layers/MapImageLayer"
				],
				function(
					esriConfig,
					Map,
					MapView,
					featurelayer,
					layerlist,
					mapimagelayer) {
					esriConfig.apiKey =
						"AAPKd74da932b0b443c99fb257a1dedbac73j6eRjSQrRBL026xj4eQq6Qume6HP14Kwuw7ML0GB-dh_bDpza7wncWjEcNxZPfKV";
						
						
						
					const map = new Map({
						basemap: "osm-standard" // Basemap layer service
					});
					const map2 = new Map({
						basemap: "arcgis-nova" // Basemap layer service
					});
					const map3 = new Map({
						basemap: "arcgis-navigation" // Basemap layer service
					});
					//底图切换函数
					function basemapserver(n){
						if(n==1){
							map.basemap = "arcgis-light-gray"
						} 
						else if(n==2){
							map.basemap = "arcgis-navigation"
						}
						else if(n==3){
							map.basemap = "arcgis-oceans"
						}
						else if(n==4){
							map.basemap = "arcgis-community"
						}
						else if(n==5){
							map.basemap = "osm-dark-gray"
						}
						
					};
					window.basemapserver = basemapserver;
					//两个地图同时显示
					const view = new MapView({
						container: "viewDiv1",
						map: map,
						center: [-100, 30], // Longitude, latitude
						zoom: 2, // Zoom level
						
					});
					const view2 = new MapView({
						container: "viewDiv2",
						map: map2,
						center: [-100, 30], // Longitude, latitude
						zoom: 2, // Zoom level
						
					});
					const view3 = new MapView({
						container: "viewDiv3",
						map: map3,
						center: [-100, 30], // Longitude, latitude
						zoom: 2, // Zoom level
						
					});
					
					view.on(["drag","mouse-wheel","hold"],function(event){
						setTimeout(function(){
							view2.viewpoint = view.viewpoint
						},50)
					});
					view.on(["drag","mouse-wheel","hold"],function(event){
						setTimeout(function(){//settimeout是一个延时函数，一个javascript内置函数
							view3.viewpoint = view.viewpoint
						},50)
					});

					const layer1 = new featurelayer({
						title: "layer feature service",
						url: "https://sampleserver6.arcgisonline.com/arcgis/rest/services/Earthquakes_Since1970/MapServer"
					});
					
					const layer2 = new featurelayer({
						title: "layer map service",
						url: "https://sampleserver6.arcgisonline.com/arcgis/rest/services/USA/MapServer"
					});
					
					const layer3 = new mapimagelayer({
						title: "layer mapimage service",
						url: "https://sampleserver6.arcgisonline.com/arcgis/rest/services/Census/MapServer"
					});
					//卷帘
					view3.on("drag", function (evt) {
						evt.stopPropagation();
						document.getElementById("viewDiv3").style.clip ="rect(0px," + evt.x + "px,750px,0px)";
					});
					// const llist = new layerlist({
					// 	view:view
						
					// });
					// view.ui.add(llist,{
					// 	position:"top-left"
					// });
					
					//实时显示坐标
					view.on("pointer-move",
					function(event){
						let longi = view.toMap(event).longitude;
						let lati = view.toMap(event).latitude;
						var coordiv = document.getElementById("coordiv");
						coordiv.innerHTML = "经度:"+longi.toFixed(2)+
						";"+"纬度:"+lati.toFixed(2);
					});
					
					
					map.add(layer3);
					map.add(layer2);
					map.add(layer1);
					layer3.visible = false;
					layer2.visible = false;
					layer1.visible = false;
					
					//比例尺
					var scale = document.getElementById("scale");
					var scalediv = document.createElement("scalediv");
					scale.appendChild(scalediv);
					view.on(["pointer-down","mouse-wheel","pointer-move"],function(event){
						var scale = view.scale.toFixed(0);
						scalediv.innerHTML = "1:"+scale;
					});
					
					
					//图层选择函数
					function featurelayerselect(){
						if($('#featurelayer_1').is(':checked')){
							layer1.visible = true
						}
						else{
							layer1.visible = false
						}
						
						if($('#featuremaplayer_1').is(':checked')){
							layer2.visible = true
						}
						else{
							layer2.visible = false
						}
						
						if($('#featureimagelayer_1').is(':checked')){
							layer3.visible = true
						}
						else{
							layer3.visible = false
						}
					}
					window.featurelayerselect = featurelayerselect;
					//删除图层
					function deletefeature(tableID, obj,ID) { 
						var rowIndex = obj.parentElement.parentElement.rowIndex;
						obj.parentElement.parentElement.parentElement.deleteRow(rowIndex);
						switch (ID) {
							case "featurelayer_1": map.remove(layer1); 
							break;
							case "featuremaplayer_1": map.remove(layer2); 
							break;
							case "featureimagelayer_1": map.remove(layer3); 
							break;
						}
					}
					window.deletefeature = deletefeature;
					
					
				});
				
		</script>

	</head>
	<body>

		<div id="viewDiv1"></div>
		<div id="viewDiv2"></div>
		<div id="viewDiv3"></div>
		<!-- 经纬度 -->
		<div id="div1" style="width:180px;
		height:180px; 
		top: 80px;
		left: 30px;
		position: absolute;
		z-index: 9999;
		overflow-y:scroll;
		overflow-x:scroll;
		border: 1px solid black;
		background-color: white;"
		 draggable="true">
			<table border="1">
				<tr onclick="basemapserver(1)">
					<td>arcgis-light-gray</td>
				</tr>
				<tr onclick="basemapserver(2)">
					<td>arcgis-navigation</td>
				</tr>
				<tr onclick="basemapserver(3)">
					<td>arcgis-oceans</td>
				</tr>
				<tr onclick="basemapserver(4)">
					<td>arcgis-community</td>
				</tr>
				<tr onclick="basemapserver(5)">
					<td>osm-dark-gray</td>
				</tr>
			</table>
		</div>
		<!-- 经纬度 -->
		<div id="coordiv" style="width:180px;
		height:25px; 
		bottom: 30px;
		right: 30px;
		position: absolute;
		z-index: 9999;
		background-color: white;">
		</div>
		<!-- 比例尺 -->
		<div id="scale" style="height: 75px;width: 250px;top: 600px;left: 10px;z-index: 99999;position:fixed;overflow:auto;">
		</div>
		<!-- 图层选择 -->
		<div id="div2" style="width:180px; 
		height:180px; 
		top: 80px;
		right: 30px;
		position: absolute;
		z-index: 9999;
		border: 1px solid black;
		background-color: white;"
		 draggable="true">
			<table id="tb" border="0">
				<tr id="featurelayer">
					<td>
						<input type="checkbox" id="featurelayer_1" onclick="featurelayerselect()">
						<label for="featureLayer_1">Earthquakes</label>
						<input type="button" value="删除" onclick="deletefeature('tb',this,'featurelayer_1')" />
					</td>
				</tr>
				<tr id="featuremaplayer">
					<td>
						<input type="checkbox" id="featuremaplayer_1" onclick="featurelayerselect()">
						<label for="featuremaplayer_1">USA</label>
						<input type="button" value="删除" onclick="deletefeature('tb',this,'featuremaplayer_1')" />
					</td>
				</tr>
				<tr id="featureimagelayer">
					<td>
						<input type="checkbox" id="featureimagelayer_1" onclick="featurelayerselect()">
						<label for="featureimagelayer_1">Census</label>
						<input type="button" value="删除" onclick="deletefeature('tb',this,'featureimagelayer_1')" />
					</td>
				</tr>
			</table>
		</div>

	</body>
</html>
